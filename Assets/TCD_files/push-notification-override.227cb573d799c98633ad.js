(window.webpackJsonp=window.webpackJsonp||[]).push([[64],{376:function(i,s,e){"use strict";function n(i,s){window.dataLayer.push({event:"PushNotification",context:i,action:s})}XF.Event.extend("push-cta",{init:function(){if(XF.config.skipPushNotificationCta||!XF.Push.isSupported()||"denied"===Notification.permission||this.getDismissCookie()||XF.Push.hasUserPreviouslyDenied(XF.config.userId))this.removeNotification();else{if("granted"===Notification.permission&&XF.Push.hasUserPreviouslySubscribed(XF.config.userId))return this.removeNotification(),void this.registerWorker();this.registerWorker(),$(".js-enablePushLink").on("click",XF.proxy(this,"linkClick")),$(".js-dismissPerm").on("click",XF.proxy(this,"dismissPerm")),$(".js-dismissAlways").on("click",XF.proxy(this,"dismissPerm")),$(document).on("push:init-subscribed",XF.proxy(this,"hidePushContainer")),$("#enable_push_notifications").on("animationend webkitAnimationEnd mozAnimationEnd",(function(){n("Shown","Prompt shown to user")}))}},removeNotification:function(){this.hidePushContainer(),this.setDismissCookie(!0)},hidePushContainer:function(){$("#enable_push_notifications").remove()}}),$(document).ready((function(){XF.config.userId||XF.Cookie.remove("push_notice_dismiss")})),$(document).on("click",".js-enablePushLink",(function(){n("Dismissal","Push notifications enabled")})),$(document).on("click",".js-dismissPerm",(function(){n("Dismissal","Prompt dismissed"),XF.Push.removeUserFromPushHistory()})),$(document).on("click",".js-dismissAlways",(function(){n("PermanentDismissal","Prompt permanently dismissed"),XF.ajax("post","/disable-push-subscription")})),XF.Push.updateUserSubscription=function(i,s){if("update"!==s||!XF.Cookie.get("push_subscription_updated")){var e=i.getKey("p256dh"),n=i.getKey("auth"),o=(PushManager.supportedContentEncodings||["aesgcm"])[0];$.ajax({url:XF.canonicalizeUrl("index.php?misc/update-push-subscription"),type:"post",data:{endpoint:i.endpoint,key:e?btoa(String.fromCharCode.apply(null,new Uint8Array(e))):null,token:n?btoa(String.fromCharCode.apply(null,new Uint8Array(n))):null,encoding:o,unsubscribed:"unsubscribe"===s?1:0,_xfResponseType:"json",_xfToken:XF.config.csrf},cache:!1,dataType:"json",global:!1}).always((function(){var e=i.expirationTime?i.expirationTime-864e5:12096e5;"update"===s&&XF.Cookie.set("push_subscription_updated","1",new Date(Date.now()+e))}))}},XF.Push.hasUserPreviouslyDenied=function(i){return!1===XF.Push.getPushHistoryUserIds()[i||XF.config.userId]},XF.Push.removeUserFromPushHistory=function(i){var s=XF.Push.getPushHistoryUserIds();s[i||XF.config.userId]=!1,XF.Push.setPushHistoryUserIds(s)}}},[[376,0]]]);