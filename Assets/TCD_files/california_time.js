var secondsInMinute=60;var secondsInHour=60*secondsInMinute;var secondsInDay=24*secondsInHour;var secondsInMonth=31*secondsInDay;var secondsInYear=12*secondsInMonth;XF.CaliforniaDynamicDate=(function(){var localLoadTime;var serverLoadTime;var todayStart;var todayDow;var tomorrowStart;var initialized=false;var interval;var startInterval=function(){interval=setInterval(function(){refresh(document);},20*1000);};var initialize=function(){if(initialized){return;}
initialized=true;var time=XF.config.time;localLoadTime=XF.getLocalLoadTime();serverLoadTime=time.now;todayStart=time.today;todayDow=time.todayDow;tomorrowStart=todayStart+secondsInDay;if(document.hidden!==undefined){if(!document.hidden){startInterval();}
$(document).on("visibilitychange",function(){if(document.hidden){clearInterval(interval);}else{startInterval();refresh(document);}});}else{startInterval();}};var refresh=function(root){if(!initialized){this.initialize();}
var $els=$(root).find("time[california-data-time]");var length=$els.length;var now=Math.floor(new Date().getTime()/1000);var openLength=now-localLoadTime;var el,$el,interval,futureInterval,dynType,thisTime;if(serverLoadTime+openLength>todayStart+secondsInDay){var dayOffset=Math.floor((serverLoadTime+openLength-todayStart)/secondsInDay);todayStart+=dayOffset*secondsInDay;todayDow=(todayDow+dayOffset)%7;tomorrowStart=todayStart+secondsInDay;}
for(var i=0;i<length;i++){el=$els[i];$el=$(el);thisTime=parseInt(el.getAttribute("california-data-time"),10);interval=serverLoadTime-thisTime+openLength;dynType=el.xfDynType;if(interval<-2){futureInterval=thisTime-(serverLoadTime+openLength);if(futureInterval<secondsInMinute*15){if(dynType!=="futureMoment"){$el.text(XF.phrase("in_a_moment"));el.xfDynType="futureMoment";}}else if(futureInterval<secondsInHour){var minutes=Math.round(futureInterval/secondsInMinute);if(dynType!=="futureMinutes"+minutes){$el.text(XF.phrase("in_x_minutes",{"{minutes}":minutes}));el.xfDynType="futureMinutes"+minutes;}}else if(thisTime<tomorrowStart){if(dynType!=="latertoday"){$timeLaterToday=getTwelveHourTime(thisTime);$el.text(XF.phrase("later_today_at_x",{"{time}":$timeLaterToday}));el.xfDynType="latertoday";}}else if(thisTime<tomorrowStart+secondsInDay){if(dynType!=="tomorrow"){$el.text(XF.phrase("tomorrow_at_x",{"{time}":$el.attr("data-time-string")}));el.xfDynType="tomorrow";}}else if(futureInterval<7*secondsInDay){el.xfDynType="future";}else{if($el.attr("data-full-date")){$el.text(XF.phrase("date_x_at_time_y",{"{date}":$el.attr("data-date-string"),"{time}":$el.attr("data-time-string")}));}else{$el.text($el.attr("data-date-string"));}
el.xfDynType="future";}}else if(interval<=secondsInMinute*15){$el.text(XF.phrase("california_a_moment_ago"));}else if(interval<secondsInHour){$el.text(XF.phrase("california_x_mins_ago",{'{mins}':Math.round(interval/secondsInMinute)}));}else if(interval<secondsInDay){$el.text(XF.phrase("california_x_hours_ago",{'{hours}':Math.round(interval/secondsInHour)}));}else if(interval<secondsInMonth){$el.text(XF.phrase("california_x_days_ago",{'{days}':Math.round(interval/secondsInDay)}));}else if(interval<secondsInYear){$el.text(XF.phrase("california_x_months_ago",{'{months}':Math.round(interval/secondsInMonth)}));}else{$el.text($el.attr("data-date-string"));}}};return{initialize:initialize,refresh:refresh};})();function getTwelveHourTime(timeStamp){var dt=new Date(timeStamp*1000);var hours=dt.getHours();var minutes=dt.getMinutes();var ampm=hours>=12?'PM':'AM';hours=(hours%12);hours=hours?hours:12;minutes=minutes<10?'0'+minutes:minutes;return hours+':'+minutes+' '+ampm;}
XF.CaliforniaDynamicDate.initialize();XF.CaliforniaDynamicDate.refresh(document);